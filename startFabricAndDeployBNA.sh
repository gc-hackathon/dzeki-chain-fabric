#!/bin/bash
echo "================================================================="
echo "================================================================="
echo "================================================================="
echo "Creating BNA"
echo "================================================================="
echo "================================================================="
echo "================================================================="
composer archive create -a dist/dzeki-chain.bna --sourceType dir --sourceName ./dzeki-chain

echo "================================================================="
echo "================================================================="
echo "================================================================="
cd ./fabric-tools
echo "Cleaning Fabric"
echo "================================================================="
echo "================================================================="
echo "================================================================="
./stopFabric.sh
./teardownFabric.sh

echo "================================================================="
echo "================================================================="
echo "================================================================="
echo "Starting FABRIC"
echo "================================================================="
echo "================================================================="
echo "================================================================="
./startFabric.sh
./createPeerAdminCard.sh

composer card delete -n PeerAdmin@fabric-network
composer card delete -n admin@dzeki-chain

cd ..

echo "================================================================="
echo "================================================================="
echo "================================================================="

echo "Installing the composer runtime"
echo "================================================================="
echo "================================================================="
echo "================================================================="
composer runtime install --card PeerAdmin@hlfv1 --businessNetworkName dzeki-chain

echo "================================================================="
echo "================================================================="
echo "================================================================="
echo "Deploying BNA"
echo "================================================================="
echo "================================================================="
echo "================================================================="
composer network start --card PeerAdmin@hlfv1 --networkAdmin admin --networkAdminEnrollSecret adminpw --archiveFile ./dist/dzeki-chain.bna --file networkadmin.card

echo "================================================================="
echo "================================================================="
echo "================================================================="
echo "Importing network admin"
echo "================================================================="
echo "================================================================="
echo "================================================================="
composer card import --file networkadmin.card

echo "================================================================="
echo "================================================================="
echo "================================================================="
echo "Checking network"
echo "================================================================="
echo "================================================================="
echo "================================================================="
composer network ping --card admin@dzeki-chain


echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"
echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"
echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"
echo "Don't forget to shutdown and clear fabric stuff"

